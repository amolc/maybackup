const countriesVO = {
  GB: "Intro Ai VO.mp3#t=0.001",
  DE: "ADA-DE-VO.mp3#t=0.001",
  SG: "ADA-DE-VO.mp3#t=0.001",
  PH: "ADA-DE-VO.mp3#t=0.001"
};

const countriesARVO = {
  GB: "ARIntro VO.mp3#t=0.001",
  DE: "ARIntro-VO-DE.mp3#t=0.001",
  SG: "ARIntro-VO-DE.mp3#t=0.001",
  PH: "ARIntro-VO-DE.mp3#t=0.001"
};

const arARVO = [
  {
    GB: 'Blower VO.mp3#t=0.001',
    DE: 'Blower-VO-DE.mp3#t=0.001',
    SG: 'Blower-VO-DE.mp3#t=0.001',
    PH: 'Blower-VO-DE.mp3#t=0.001'
  },
  {
    GB: 'Mirror VO.mp3#t=0.001',
    DE: 'Mirror-VO-DE.mp3#t=0.001',
    SG: 'Mirror-VO-DE.mp3#t=0.001',
    PH: 'Mirror-VO-DE.mp3#t=0.001'
  },
  {
    GB: 'Nail Polish VO.mp3#t=0.001',
    DE: 'Nail-Polish-VO-DE.mp3#t=0.001',
    SG: 'Nail-Polish-VO-DE.mp3#t=0.001',
    PH: 'Nail-Polish-VO-DE.mp3#t=0.001'
  },
  {
    GB: 'Gift VO.mp3#t=0.001',
    DE: 'Gift-VO-DE.mp3#t=0.001',
    SG: 'Gift-VO-DE.mp3#t=0.001',
    PH: 'Gift-VO-DE.mp3#t=0.001'
  }
]

const imgLoc = [
  {   
    GB: "assets/Click to play - CTA.svg",
    DE: "assets/loc/img/DE/Click to play - CTA.svg",
    SG: "assets/loc/img/DE/Click to play - CTA.svg",
    PH: "assets/loc/img/DE/Click to play - CTA.svg"
  },
  {   
    GB: "assets/shop-online-btn.webp",
    DE: "assets/loc/img/DE/shop-online-btn.webp",
    SG: "assets/loc/img/DE/shop-online-btn.webp",
    PH: "assets/loc/img/DE/shop-online-btn.webp"
  },
  {   
    GB: "assets/ada-new-title.png",
    DE: "assets/loc/img/DE/ada-new-title.png",
    SG: "assets/loc/img/DE/ada-new-title.png",
    PH: "assets/loc/img/DE/ada-new-title.png"
  },
  {   
    GB: "assets/ask-me-anyting.svg",
    DE: "assets/loc/img/DE/ask-me-anyting.svg",
    SG: "assets/loc/img/DE/ask-me-anyting.svg",
    PH: "assets/loc/img/DE/ask-me-anyting.svg"
  },
  {   
    GB: "assets/tap-to-speak.svg",
    DE: "assets/loc/img/DE/tap-to-speak.svg",
    SG: "assets/loc/img/DE/tap-to-speak.svg",
    PH: "assets/loc/img/DE/tap-to-speak.svg"
  },
  {   
    GB: "assets/tap-to-stop.svg",
    DE: "assets/loc/img/DE/tap-to-stop.svg",
    SG: "assets/loc/img/DE/tap-to-stop.svg",
    PH: "assets/loc/img/DE/tap-to-stop.svg"
  }
]


const txtSplash = [
  {
    GB: "This augmented reality experience requires access to your device's camera",
    DE: "Diese IvyBears Ai und Augmented Reality Experience erfordert den Zugriff auf Ihre Kamera.",
    SG: "Diese IvyBears Ai und Augmented Reality Experience erfordert den Zugriff auf Ihre Kamera.",
    PH: "Diese IvyBears Ai und Augmented Reality Experience erfordert den Zugriff auf Ihre Kamera."
  },
  {
    GB: "ALLOW ACCESS",
    DE: "ZUGRIFF ERLAUBEN",
    SG: "ZUGRIFF ERLAUBEN",
    PH: "ZUGRIFF ERLAUBEN"
  }
];

const txtAccess = [
  {
    GB: "Allow sounds and music.",
    DE: "Musik & GerÃ¤usche zulassen",
    SG: "Musik & GerÃ¤usche zulassen",
    PH: "Musik & GerÃ¤usche zulassen"
  },
  {
    GB: "ALLOW",
    DE: "ZULASSEN",
    SG: "ZULASSEN",
    PH: "ZULASSEN"
  }
];

const txtLanding = [
  {
    GB: "ðŸ» What is Ivybears' most popular product?",
    SG: "ðŸ» Welches ist das beliebteste Produkt von Ivybears?",
    PH: "ðŸ» Welches ist das beliebteste Produkt von Ivybears?",
    DE: "ðŸ» Welches ist das beliebteste Produkt von Ivybears?"
  },
  {
    GB: "ðŸƒ Are Ivybears gummies vegan and sugar-free?",
    SG: "ðŸƒ Sind die GummibÃ¤rchen von Ivybears vegan und zuckerfrei?",
    PH: "ðŸƒ Sind die GummibÃ¤rchen von Ivybears vegan und zuckerfrei?",
    DE: "ðŸƒ Sind die GummibÃ¤rchen von Ivybears vegan und zuckerfrei?"
  },
  {
    GB: "ðŸ«™ How many products does Ivybears have?",
    SG: "ðŸ«™ Wie viele Produkte hat Ivybears?",
    PH: "ðŸ«™ Wie viele Produkte hat Ivybears?",
    DE: "ðŸ«™ Wie viele Produkte hat Ivybears?"
  },
  {
    GB: "ðŸ§ª Do Ivybears contain any artificial ingredients?",
    SG: "ðŸ§ª Enthalten Ivybears kÃ¼nstliche Inhaltsstoffe?",
    PH: "ðŸ§ª Enthalten Ivybears kÃ¼nstliche Inhaltsstoffe?",
    DE: "ðŸ§ª Enthalten Ivybears kÃ¼nstliche Inhaltsstoffe?"
  },
  {
    GB: "ðŸ’ª How long before Ivybears show visible results?",
    SG: "ðŸ’ª Wie lange dauert es, bis Ivybears sichtbare Ergebnisse zeigt?",
    PH: "ðŸ’ª Wie lange dauert es, bis Ivybears sichtbare Ergebnisse zeigt?",
    DE: "ðŸ’ª Wie lange dauert es, bis Ivybears sichtbare Ergebnisse zeigt?"
  },
  {
    GB: "âš—ï¸ Are Ivybears clinically tested for effectiveness?",
    SG: "âš—ï¸ Wurde die Wirksamkeit von Ivybears klinisch getestet?",
    PH: "âš—ï¸ Wurde die Wirksamkeit von Ivybears klinisch getestet?",
    DE: "âš—ï¸ Wurde die Wirksamkeit von Ivybears klinisch getestet?"
  },
  {
    GB: "Speaking...",
    // SG: "Spracheingabe...",
    // PH: "Spracheingabe...",
    // DE: "Spracheingabe..."
    SG: "einen Moment bitteâ€¦",
    PH: "einen Moment bitteâ€¦",
    DE: "einen Moment bitteâ€¦"
  },
  {
    GB: "Thinking...",
    // SG: "einen Moment...",
    // PH: "einen Moment...",
    // DE: "einen Moment..."
    SG: "einen Moment bitteâ€¦",
    PH: "einen Moment bitteâ€¦",
    DE: "einen Moment bitteâ€¦"
  }
];

const txtARLanding = [
  {
    GB: "Tap To Learn More",
    SG: "Tippen Sie hier, um mehr zu erfahren",
    PH: "Tippen Sie hier, um mehr zu erfahren",
    DE: "Tippen Sie hier, um mehr zu erfahren"
  }
];

const txtShopNow = [
  {
    GB: "off when you spend over â‚¬80 on our website",
    SG: "Rabatt ab einem Einkaufswert von 80â‚¬ auf unserer Website",
    PH: "Rabatt ab einem Einkaufswert von 80â‚¬ auf unserer Website",
    DE: "Rabatt ab einem Einkaufswert von 80â‚¬ auf unserer Website"
  },
  {
    GB: "Promo Code",
    SG: "Gutscheincode",
    PH: "Gutscheincode",
    DE: "Gutscheincode"
  }
];

var localCountryCode = '';
var localLanguage = '';

function runTranslation(countryCode) {
  if (countriesVO[countryCode] !== null && countriesVO[countryCode] !== undefined) {
    document.getElementById('ai-vo').setAttribute('src','assets/Media/VO/' + countriesVO[countryCode]);
    document.getElementById('ar-intro').setAttribute('src','assets/Media/ARVO/' + countriesARVO[countryCode]);

    document.getElementById('ar-blower').setAttribute('src','assets/Media/ARVO/' + arARVO[0][countryCode]);
    document.getElementById('ar-mirror').setAttribute('src','assets/Media/ARVO/' + arARVO[1][countryCode]);
    document.getElementById('ar-nail-polish').setAttribute('src','assets/Media/ARVO/' + arARVO[2][countryCode]);
    document.getElementById('ar-gift').setAttribute('src','assets/Media/ARVO/' + arARVO[3][countryCode]);
  
    //Splash
    document.querySelector('.camera-prompt .prompt-message h3').textContent = txtSplash[0][countryCode];
    document.querySelector('.camera-prompt .click-camera').textContent = txtSplash[1][countryCode];

    //Access
    document.querySelector('.custom-popup .popup-container h3').textContent = txtAccess[0][countryCode];
    document.querySelector('.custom-popup .popup-container .on-sound').textContent = txtAccess[1][countryCode];

    //Landing01
    document.querySelector('.suggestions-slider:nth-child(1) .suggestions-box:nth-child(1) .suggestions-text p').textContent = txtLanding[0][countryCode];
    document.querySelector('.suggestions-slider:nth-child(1) .suggestions-box:nth-child(2) .suggestions-text p').textContent = txtLanding[1][countryCode];

    //Landing02
    document.querySelector('.suggestions-slider:nth-child(2) .suggestions-box:nth-child(1) .suggestions-text p').textContent = txtLanding[2][countryCode];
    document.querySelector('.suggestions-slider:nth-child(2) .suggestions-box:nth-child(2) .suggestions-text p').textContent = txtLanding[3][countryCode];

    //Landing03
    document.querySelector('.suggestions-slider:nth-child(3) .suggestions-box:nth-child(1) .suggestions-text p').textContent = txtLanding[4][countryCode];
    document.querySelector('.suggestions-slider:nth-child(3) .suggestions-box:nth-child(2) .suggestions-text p').textContent = txtLanding[5][countryCode];

    //chatbox prompt
    document.querySelector('.voice-timer p:nth-child(1)').textContent = txtLanding[6][countryCode];

    //ARLanding
    document.querySelector('.tap-to-learn-container h2 span.tap-cta').textContent = txtARLanding[0][countryCode];

    //Images
    document.querySelectorAll('img.click-to-play').forEach(el => el.src = imgLoc[0][countryCode]); // Gift
    document.querySelector('.shop-now-popup a img').src = imgLoc[1][countryCode];
    document.querySelector('.animation-sequence-container img:nth-child(1)').src = imgLoc[2][countryCode];
    document.querySelector('img.ask-me-anyting').src = imgLoc[3][countryCode];
    document.querySelector('#startRecord img').src = imgLoc[4][countryCode];
    document.querySelector('#stopRecord img').src = imgLoc[5][countryCode];

    //ShopNow
    document.querySelector('.shop-now-inner h3 span.norm').textContent = txtShopNow[0][countryCode];
    document.querySelector('.shop-now-inner h3.black').textContent = txtShopNow[1][countryCode];

  }

  document.getElementById('arIntroImg').setAttribute('src','assets/Media/'+ localLanguage +'/ARIntro/ARHair_Intro_00000.webp');
  document.getElementById('arIdleImg').setAttribute('src','assets/Media/'+ localLanguage +'/ARIdle/ARBear_Idle_00000.webp');
  document.getElementById('arGiftImg').setAttribute('src','assets/Media/'+ localLanguage +'/ARGift/ARBear_Gift_00000.webp');
  document.getElementById('arBlowerImg').setAttribute('src','assets/Media/'+ localLanguage +'/ARBlower/ARBear_Blower_00000.webp');
  document.getElementById('arNailPolishImg').setAttribute('src','assets/Media/'+ localLanguage +'/ARBlower/ARBear_Blower_00000.webp');
  document.getElementById('arMirrorImg').setAttribute('src','assets/Media/'+ localLanguage +'/ARBlower/ARBear_Blower_00000.webp');

}

window.addEventListener("load", () => {
  // Check if Geolocation is available

  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(onSuccess, onError);
  } else {
    console.log("Geolocation is not supported by this browser.");
  }

  function onSuccess(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      getCountryFromCoordinates(lat, lng);
    }

    function onError(error) {
      console.log("Unable to retrieve location. " + error.message);
    }

    function getCountryFromCoordinates(lat, lng) {
      // 1) Replace with your valid Google Maps Geocoding API key
      const googleApiKey = "AIzaSyAoBfRcqPY61h115UrvUoTGwXfRTO_FnBs"; 
      // 2) Construct the Geocoding API request
      const geocodeUrl = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=${googleApiKey}`;

      // 3) Fetch the JSON response
      fetch(geocodeUrl)
        .then((response) => response.json())
        .then((data) => {
          if (data.status === "OK" && data.results.length > 0) {
            // Parse address components to find the country
            const addressComponents = data.results[0].address_components;
            const countryComponent = addressComponents.find((component) =>
              component.types.includes("country")
            );

            if (countryComponent) {
              console.log(`You are in ${countryComponent.short_name}.`);

              // if(["SG"].includes(countryComponent.short_name)) {
              if(["SG", "PH"].includes(countryComponent.short_name)) {
                localCountryCode = 'GB';
              } else if([].includes(countryComponent.short_name)) {
                localCountryCode = 'DE';
              } 
              else {
                localCountryCode = countryComponent.short_name; //ai.js
              }

              // localLanguage = ["DE","PH"].includes(localCountryCode) ? "DE" : "EN"; //main.js
              localLanguage = ["DE"].includes(localCountryCode) ? "DE" : "EN"; //main.js

              runTranslation(localCountryCode);

            } else {
              console.log("Unable to find country data.");
            }
          } else {
            console.log("Geocoding API error: " + data.status);
          }
        })
        .catch((err) => {
          console.log("Request failed. " + err);
        });
    }
});